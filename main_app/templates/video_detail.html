{% extends 'base.html' %}
{% block content %}
<p>video detail page</p>
<p>user Id: {{user.id}}</p>
<p>title: {{video.title}}</p>
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
{% if not thumbnail %}
  {% if video.user_id == user.id %}
    <form action="{% url 'add_thumb' video.id %}" enctype="multipart/form-data" method="POST" alt="thumbnail">
      {% csrf_token %}
      <input type="file" name="photo-file">
      <br>
      <input type="submit" value="Upload Thumbnail">
    </form>
  {% endif %}
{% elif thumbnail %}
  <img src="{{thumbnail.url}}" alt="" srcset="">
{% endif %}
{% if not media %}
  {% if video.user_id == user.id %}
    <form action="{% url 'add_media' video.id %}" enctype="multipart/form-data" method="POST" alt="media">
      {% csrf_token %}
      <label for="media-file">We support MP4, WebM, and OGG formats!</label>
      <input type="file" name="media-file">
      <br>
      <input type="submit" value="Upload Media">
    </form>
  {% endif %}
{% elif media %}
  <video src="{{media.url}}" controls></video>
{% endif %}

<p>description: {{video.description}}</p>
<p>Views: {{video.view}}</p>
<p>Uploaded by: {{video.user}}</p>
{% if video.user_id == user.id %}
<a href="{% url 'video_update' video.pk %}">
  <span class="icon">
    <i class="fa-regular fa-edit"></i>
  </span>
</a>
<a href="{% url 'video_delete' video.pk %}">
  <span class="icon">
    <i class="fa-regular fa-trash-can"></i>
  </span>
</a>
{% endif %}

<!-- if there are comments, show how many comments there are, as well as iterate through the list of comments and showing them. -->
{% if comments %}
<div>
  <div>
    Comment{{ comments.count|pluralize }}
    <span>{{ comments.count }}</span>
  </div>
  {% for comment in comments %}
  <div>
    <div class="card p-2">
      <div class="row">
        <div class="col-12">
          <strong>{{ comment.user }}</strong>
        </div>
        <div class="col-12">
          <p>{{ comment.body }}</p>
          <p><small>{{ comment.created_at|timesince }} ago</small></p>
          {% if comment.user_id == user.id %}
          <a href="{% url 'comment_update' video_pk=video.pk pk=comment.id%}">
            <span class="icon">
              <i class="fa-regular fa-edit"></i>
            </span>
          </a>
          <a href="{% url 'comment_delete' video_pk=video.pk pk=comment.id%}">
            <span class="icon">
              <i class="fa-regular fa-trash-can"></i>
            </span>
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Form to leave comment -->
<div class="row mt-5">
  <div class="col-lg-6 offset-lg-3">
    <h3>Leave a comment</h3>
    <form method='POST'>
      {% csrf_token %}
      <div class="form-group">
        <textarea class="form-control {% if form.body.errors %}is-invalid{% endif %}" id="id_body" name="body"
          rows="4">{{ form.body.value|default:'' }}</textarea>
      </div>
      <button type="submit">Comment</button>
    </form>
  </div>
</div>
{% endblock %}